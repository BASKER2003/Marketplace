{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<div class="container py-4">
  <h2 class="fw-bold mb-3">Messages
    <a class="w-bold btn btn-outline-primary float-end" href="{{ url_for('dashboard') }}"><i class="bi bi-arrow-left me-2"></i> Back to Dashboard</a>
  </h2>

  {% if conversations|length == 0 %}
    <div class="text-center py-5 text-muted">
      <i class="bi bi-chat-left-quote fs-1"></i>
      <p class="mt-3">No conversations yet. Start by messaging a seller from a listing.</p>
      <a href="{{ url_for('marketplace') }}" class="btn btn-primary"><i class="bi bi-shop"></i> Browse Marketplace</a>
    </div>
  {% else %}
    <div class="list-group">
      {% for c in conversations %}
        <a href="{{ url_for('chat_view', conversation_id=c.id) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-start">
          <div class="ms-2 me-auto">
            <div class="fw-bold">{{ c.other_name }}</div>
            <div class="small text-truncate">{{ c.last_message or '' }}</div>
          </div>
          <div class="text-end">
            {% if c.unread_count and c.unread_count > 0 %}
              <span class="badge bg-danger rounded-pill">{{ c.unread_count }}</span>
            {% endif %}
            <div class="small text-muted mt-1">{{ c.last_at or '' }}</div>
          </div>
        </a>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
